<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Plan - Simulation Training | Decision Stream</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #e8eaed;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p {
            color: #a0aec0;
            font-size: 14px;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title .icon {
            font-size: 24px;
        }
        .form-section {
            margin-bottom: 24px;
        }
        .section-label {
            font-size: 14px;
            font-weight: 600;
            color: #a0aec0;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            font-size: 13px;
            color: #cbd5e0;
            margin-bottom: 6px;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 10px 14px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            color: #e8eaed;
            font-size: 14px;
            transition: all 0.2s;
        }
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(0,0,0,0.4);
        }
        select.form-control {
            cursor: pointer;
        }
        .radio-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .radio-option {
            flex: 1;
            min-width: 100px;
        }
        .radio-option input[type="radio"] {
            display: none;
        }
        .radio-option label {
            display: block;
            padding: 10px 16px;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
        }
        .radio-option input[type="radio"]:checked + label {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
            color: #fff;
        }
        .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e8eaed;
            margin-top: 10px;
        }
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        .result-item {
            background: rgba(0,0,0,0.3);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .result-label {
            font-size: 12px;
            color: #a0aec0;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .result-value {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
        }
        .result-value.green {
            color: #48bb78;
        }
        .result-value.red {
            color: #f56565;
        }
        .result-value.yellow {
            color: #ecc94b;
        }
        .checklist {
            margin-top: 20px;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
        }
        .checklist-item.pass {
            border-left-color: #48bb78;
        }
        .checklist-item.fail {
            border-left-color: #f56565;
        }
        .checklist-item .icon {
            font-size: 18px;
        }
        .checklist-item .text {
            flex: 1;
            font-size: 13px;
        }
        .checklist-item .status {
            font-weight: 600;
            font-size: 12px;
        }
        .history-table {
            width: 100%;
            margin-top: 20px;
        }
        .history-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .history-table th {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            text-align: left;
            font-size: 12px;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .history-table td {
            padding: 12px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .history-table tr:hover {
            background: rgba(255,255,255,0.03);
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge.success {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
        }
        .badge.danger {
            background: rgba(245, 101, 101, 0.2);
            color: #f56565;
        }
        .badge.warning {
            background: rgba(236, 201, 75, 0.2);
            color: #ecc94b;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        .stat-box {
            background: rgba(0,0,0,0.3);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-label {
            font-size: 11px;
            color: #a0aec0;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading.active {
            display: block;
        }
        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        .alert.info {
            background: rgba(66, 153, 225, 0.2);
            border-left: 3px solid #4299e1;
            color: #90cdf4;
        }
        .alert.success {
            background: rgba(72, 187, 120, 0.2);
            border-left: 3px solid #48bb78;
            color: #9ae6b4;
        }
        .alert.warning {
            background: rgba(236, 201, 75, 0.2);
            border-left: 3px solid #ecc94b;
            color: #faf089;
        }
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .result-grid {
                grid-template-columns: 1fr;
            }
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header" style="display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1;">
                <h1>ğŸ“Š Trade Plan - Simulation Training</h1>
                <p>ì¤‘ê¸° ìŠ¤ìœ™ íŠ¸ë ˆì´ë”© ì‹œë®¬ë ˆì´ì…˜ í•™ìŠµ ë„êµ¬ | ì•ˆì „í•œ ì—°ìŠµ í™˜ê²½ì—ì„œ ë§¤ë§¤ ê³„íš ìˆ˜ë¦½ ë° ê²€ì¦</p>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
                <span id="price-update-badge" style="display: none; background: rgba(66, 153, 225, 0.2); border: 1px solid rgba(66, 153, 225, 0.5); color: #90cdf4; padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 500; white-space: nowrap;">
                    ì£¼ê°€ ë¡œë”© ì¤‘...
                </span>
                <button id="back-to-index-btn" style="display: none; padding: 8px 16px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); color: #667eea; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;" 
                        onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'" 
                        onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'"
                        onclick="window.close()">
                    â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left: Input Form -->
            <div class="card">
                <div class="card-title">
                    <span class="icon">ğŸ“</span>
                    ë§¤ë§¤ ê³„íš ìˆ˜ë¦½
                </div>

                <div class="alert info">
                    <strong>ğŸ’¡ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ:</strong> ì‹¤ì œ ë§¤ë§¤ ì—†ì´ ì•ˆì „í•˜ê²Œ ì—°ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>

                <!-- Market Selection -->
                <div class="form-section">
                    <div class="section-label">1ï¸âƒ£ ì‹œì¥ ì„ íƒ</div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="market-kr" name="market" value="KR" checked>
                            <label for="market-kr">ğŸ‡°ğŸ‡· í•œêµ­</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="market-us" name="market" value="US">
                            <label for="market-us">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</label>
                        </div>
                    </div>
                </div>

                <!-- Sector & Stock -->
                <div class="form-section">
                    <div class="section-label">2ï¸âƒ£ ì¢…ëª© ì„ íƒ</div>
                    <div class="form-group">
                        <label class="form-label">ì„¹í„°</label>
                        <select id="sector" class="form-control">
                            <option value="">-- ì„¹í„° ì„ íƒ --</option>
                            <option value="ë°©ì‚°">ë°©ì‚°</option>
                            <option value="í—¬ìŠ¤ì¼€ì–´">í—¬ìŠ¤ì¼€ì–´</option>
                            <option value="ë°˜ë„ì²´">ë°˜ë„ì²´</option>
                            <option value="2ì°¨ì „ì§€">2ì°¨ì „ì§€</option>
                            <option value="ë°”ì´ì˜¤">ë°”ì´ì˜¤</option>
                            <option value="ìë™ì°¨">ìë™ì°¨</option>
                            <option value="í™”í•™">í™”í•™</option>
                            <option value="ì¡°ì„ ">ì¡°ì„ </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¢…ëª©</label>
                        <select id="stock" class="form-control" onchange="handleStockChange()">
                            <option value="">-- ë¨¼ì € ì„¹í„°ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="price-label">í˜„ì¬ ì£¼ê°€ (â‚©)</label>
                        <input type="number" id="current-price" class="form-control" placeholder="ì˜ˆ: 75000" value="">
                        
                        <!-- ë””ë²„ê¹… ì •ë³´ í‘œì‹œ -->
                        <div id="debug-info" style="margin-top: 8px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; font-size: 11px; color: #aaa; display: none;">
                            <div style="margin-bottom: 4px;">
                                <strong style="color: #667eea;">ğŸ” ë””ë²„ê·¸:</strong>
                            </div>
                            <div id="debug-text" style="font-family: monospace; line-height: 1.4;"></div>
                        </div>
                    </div>
                </div>

                <!-- Trading Parameters -->
                <div class="form-section">
                    <div class="section-label">3ï¸âƒ£ ë§¤ë§¤ ì¡°ê±´</div>
                    <div class="form-group">
                        <label class="form-label">íˆ¬ì ê¸°ê°„</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="period-short" name="period" value="ë‹¨ê¸°" checked>
                                <label for="period-short">ë‹¨ê¸° (1-2ì£¼)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="period-mid" name="period" value="ì¤‘ê¸°">
                                <label for="period-mid">ì¤‘ê¸° (1-3ê°œì›”)</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¦¬ìŠ¤í¬ ì„±í–¥</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="risk-conservative" name="risk" value="ë³´ìˆ˜" checked>
                                <label for="risk-conservative">ë³´ìˆ˜ì </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="risk-neutral" name="risk" value="ì¤‘ë¦½">
                                <label for="risk-neutral">ì¤‘ë¦½</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="risk-aggressive" name="risk" value="ê³µê²©">
                                <label for="risk-aggressive">ê³µê²©ì </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì§„ì… ì „ëµ</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="entry-immediate" name="entry" value="100" checked>
                                <label for="entry-immediate">ì¦‰ì‹œ ë§¤ìˆ˜ (í˜„ì¬ê°€)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="entry-wait" name="entry" value="98">
                                <label for="entry-wait">ì¡°ì • ëŒ€ê¸° (-2%)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="entry-deep" name="entry" value="95">
                                <label for="entry-deep">ê¹Šì€ ì¡°ì • (-5%)</label>
                            </div>
                        </div>
                        <small style="color: #718096; display: block; margin-top: 8px;">
                            ğŸ’¡ <strong>ì¦‰ì‹œ ë§¤ìˆ˜:</strong> í˜„ì¬ê°€ë¡œ ë°”ë¡œ ì§„ì… | <strong>ì¡°ì • ëŒ€ê¸°:</strong> 2% í•˜ë½ ì‹œ ì§„ì… | <strong>ê¹Šì€ ì¡°ì •:</strong> 5% í•˜ë½ ì‹œ ì§„ì…
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="capital-label">íˆ¬ì ê¸ˆì•¡ (â‚©)</label>
                        <input type="number" id="capital" class="form-control" placeholder="ì˜ˆ: 5000000" value="5000000">
                        <small id="capital-guide" style="color: #718096; display: block; margin-top: 4px;">
                            ğŸ’¡ ê¶Œì¥: ì „ì²´ ìì‚°ì˜ 20-30%
                        </small>
                    </div>
                </div>

                <!-- Action Buttons -->
                <button class="btn btn-primary" onclick="generateTradePlan()">
                    ğŸš€ ë§¤ë§¤ ê³„íš ìƒì„±
                </button>
                <button class="btn btn-secondary" onclick="openChartAnalysis()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    ğŸ“Š ì°¨íŠ¸ ë¶„ì„
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    ğŸ”„ ì´ˆê¸°í™”
                </button>
            </div>

            <!-- Right: Results -->
            <div class="card">
                <div class="card-title">
                    <span class="icon">ğŸ“ˆ</span>
                    ë§¤ë§¤ ê³„íš ê²°ê³¼
                </div>

                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>ë§¤ë§¤ ê³„íšì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>

                <div id="results" style="display: none;">
                    <!-- Market Info -->
                    <div id="market-info" style="margin-bottom: 16px; padding: 12px; background: rgba(102,126,234,0.1); border-radius: 8px; border-left: 4px solid #667eea;">
                        <div style="font-size: 13px; color: #aaa;">ì„ íƒëœ ì‹œì¥</div>
                        <div style="font-size: 16px; font-weight: 600; margin-top: 4px;" id="market-display">-</div>
                    </div>
                    
                    <!-- Plan Summary -->
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-label">ì§„ì…ê°€</div>
                            <div class="result-value green" id="entry-price">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ì†ì ˆê°€</div>
                            <div class="result-value red" id="stop-loss">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ëª©í‘œê°€ 1ì°¨</div>
                            <div class="result-value yellow" id="target-1">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ëª©í‘œê°€ 2ì°¨</div>
                            <div class="result-value yellow" id="target-2">-</div>
                        </div>
                    </div>

                    <!-- Position Info -->
                    <div class="result-grid" style="margin-top: 16px;">
                        <div class="result-item">
                            <div class="result-label">ë§¤ìˆ˜ ìˆ˜ëŸ‰</div>
                            <div class="result-value" id="quantity">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">í¬ì§€ì…˜ ë¹„ì¤‘</div>
                            <div class="result-value" id="position-size">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ì˜ˆìƒ ì†ì‹¤</div>
                            <div class="result-value red" id="max-loss">-</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">ì˜ˆìƒ ìˆ˜ìµ (1ì°¨)</div>
                            <div class="result-value green" id="expected-profit">-</div>
                        </div>
                    </div>

                    <!-- Checklist -->
                    <div class="checklist">
                        <div class="section-label">7ìš”ì†Œ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
                        <div id="checklist-items">
                            <!-- Dynamically generated -->
                        </div>
                    </div>

                    <!-- Risk Warning -->
                    <div class="alert warning" style="margin-top: 20px;">
                        <strong>âš ï¸ ë¦¬ìŠ¤í¬ ê´€ë¦¬:</strong> <span id="risk-warning">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulation History -->
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ“œ</span>
                ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡
            </div>

            <!-- Stats -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-label">ì´ ì‹œë®¬ë ˆì´ì…˜</div>
                    <div class="stat-value" id="total-sims">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ìŠ¹ë¥ </div>
                    <div class="stat-value green" id="win-rate">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">í‰ê·  ìˆ˜ìµë¥ </div>
                    <div class="stat-value" id="avg-return">0%</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ì†ìµë¹„</div>
                    <div class="stat-value" id="profit-ratio">0:0</div>
                </div>
            </div>

            <!-- History Table -->
            <div class="history-table">
                <table>
                    <thead>
                        <tr>
                            <th>ì¼ì‹œ</th>
                            <th>ì¢…ëª©</th>
                            <th>ì§„ì…ê°€</th>
                            <th>ì†ì ˆ/ëª©í‘œ</th>
                            <th>ê²°ê³¼</th>
                            <th>ìˆ˜ìµë¥ </th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        <tr>
                            <td colspan="7" style="text-align: center; color: #a0aec0; padding: 40px;">
                                ì•„ì§ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'http://127.0.0.1:8125';
        const ACCESS_KEY = 'ds-test-2026';

        // Stock data by sector
        const STOCK_DATABASE = {
            'ë°©ì‚°': [
                { ticker: 'LMT', name: 'Lockheed Martin', price: 581.00 },
                { ticker: '012450', name: 'í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤', price: 185000 },
                { ticker: '079550', name: 'LIGë„¥ìŠ¤ì›', price: 544000 }
            ],
            'í—¬ìŠ¤ì¼€ì–´': [
                { ticker: 'JNJ', name: 'Johnson & Johnson', price: 215.00 },
                { ticker: '207940', name: 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤', price: 850000 },
                { ticker: '068270', name: 'ì…€íŠ¸ë¦¬ì˜¨', price: 175000 }
            ],
            'ë°˜ë„ì²´': [
                { ticker: '005930', name: 'ì‚¼ì„±ì „ì', price: 75000 },
                { ticker: '000660', name: 'SKí•˜ì´ë‹‰ìŠ¤', price: 142000 },
                { ticker: '042700', name: 'í•œë¯¸ë°˜ë„ì²´', price: 85000 }
            ],
            '2ì°¨ì „ì§€': [
                { ticker: '373220', name: 'LGì—ë„ˆì§€ì†”ë£¨ì…˜', price: 450000 },
                { ticker: '096770', name: 'SKì´ë…¸ë² ì´ì…˜', price: 145000 },
                { ticker: '051910', name: 'LGí™”í•™', price: 380000 }
            ],
            'ë°”ì´ì˜¤': [
                { ticker: '207940', name: 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤', price: 850000 },
                { ticker: '068270', name: 'ì…€íŠ¸ë¦¬ì˜¨', price: 175000 },
                { ticker: '326030', name: 'SKë°”ì´ì˜¤íŒœ', price: 92000 }
            ],
            'ìë™ì°¨': [
                { ticker: '005380', name: 'í˜„ëŒ€ìë™ì°¨', price: 235000 },
                { ticker: '000270', name: 'ê¸°ì•„', price: 98000 },
                { ticker: '012330', name: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', price: 265000 }
            ],
            'í™”í•™': [
                { ticker: '051910', name: 'LGí™”í•™', price: 380000 },
                { ticker: '009830', name: 'í•œí™”ì†”ë£¨ì…˜', price: 42000 },
                { ticker: '011170', name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', price: 145000 }
            ],
            'ì¡°ì„ ': [
                { ticker: '009540', name: 'í•œêµ­ì¡°ì„ í•´ì–‘', price: 145000 },
                { ticker: '010140', name: 'ì‚¼ì„±ì¤‘ê³µì—…', price: 9800 },
                { ticker: '042660', name: 'í•œí™”ì˜¤ì…˜', price: 31000 }
            ]
        };

        // Simulation history
        let simulationHistory = [];

        // ========== ì£¼ê°€ ë°ì´í„° ë¡œë”© ==========
        let cachedPrices = null;
        let lastPriceUpdate = null;

        async function loadStockPrices() {
            try {
                const response = await fetch('stock_prices.json');
                if (!response.ok) {
                    console.warn('stock_prices.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì£¼ê°€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                    return null;
                }
                
                const data = await response.json();
                cachedPrices = data.prices;
                lastPriceUpdate = data.updateTime;
                
                console.log(`âœ… ì£¼ê°€ ë°ì´í„° ë¡œë“œ ì™„ë£Œ (ì—…ë°ì´íŠ¸: ${lastPriceUpdate})`);
                console.log(`   - ì„±ê³µ: ${data.successCount}ê°œ, ì‹¤íŒ¨: ${data.failCount}ê°œ`);
                
                updatePriceUpdateBadge(lastPriceUpdate);
                
                return cachedPrices;
            } catch (error) {
                console.warn('ì£¼ê°€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        function updatePriceUpdateBadge(updateTime) {
            // í—¤ë”ì— ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
            const badge = document.getElementById('price-update-badge');
            if (badge && updateTime) {
                badge.textContent = `ğŸ“Š ì£¼ê°€: ${updateTime}`;
                badge.style.display = 'inline-block';
            }
        }

        async function applyStockPrices() {
            const prices = await loadStockPrices();
            
            if (prices) {
                let updateCount = 0;
                
                // STOCK_DATABASE ì—…ë°ì´íŠ¸
                for (const sector in STOCK_DATABASE) {
                    STOCK_DATABASE[sector].forEach(stock => {
                        if (prices.stocks && prices.stocks[stock.ticker]) {
                            // stocks ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš© (ì‹œì¥ ì •ë³´ í¬í•¨)
                            const stockData = prices.stocks[stock.ticker];
                            const oldPrice = stock.price;
                            stock.price = stockData.price;
                            stock.market = stockData.market; // ì‹œì¥ ì •ë³´ ì¶”ê°€
                            
                            if (oldPrice !== stock.price) {
                                const currency = stockData.market === 'US' ? '$' : 'â‚©';
                                console.log(`ğŸ“ˆ ${stock.name} (${stock.ticker}): ${currency}${oldPrice} â†’ ${currency}${stock.price}`);
                                updateCount++;
                            }
                        } else if (prices.prices && prices.prices[stock.ticker]) {
                            // êµ¬ ë²„ì „ í˜¸í™˜ (pricesë§Œ ìˆëŠ” ê²½ìš°)
                            const oldPrice = stock.price;
                            stock.price = prices.prices[stock.ticker];
                            
                            if (oldPrice !== stock.price) {
                                console.log(`ğŸ“ˆ ${stock.name} (${stock.ticker}): ${oldPrice} â†’ ${stock.price}`);
                                updateCount++;
                            }
                        }
                    });
                }
                
                console.log(`âœ… ${updateCount}ê°œ ì¢…ëª© ì£¼ê°€ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
            } else {
                console.log('âš ï¸  ê¸°ë³¸ ì£¼ê°€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // ì£¼ê°€ ë°ì´í„° ë¨¼ì € ë¡œë“œ
            await applyStockPrices();
            
            // ê¸°ì¡´ ì´ˆê¸°í™”
            loadSimulationHistory();
            setupEventListeners();
            loadURLParameters(); // ğŸ†• URL íŒŒë¼ë¯¸í„° ìë™ ë¡œë“œ
        });

        function loadURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // URLì— íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (urlParams.has('ticker')) {
                const market = urlParams.get('market') || 'KR';
                const sector = urlParams.get('sector') || '';
                const ticker = urlParams.get('ticker') || '';
                const name = urlParams.get('name') || '';
                const price = parseFloat(urlParams.get('price')) || 0;
                const risk = urlParams.get('risk') || 'middle';
                const period = urlParams.get('period') || 'ì¤‘ê¸°';
                const capital = urlParams.get('capital') || '50000000';

                console.log('URL Parameters:', { market, sector, ticker, name, price, risk, period, capital });

                // Market ì„ íƒ
                if (market === 'US') {
                    document.querySelector('input[name="market"][value="US"]').checked = true;
                } else {
                    document.querySelector('input[name="market"][value="KR"]').checked = true;
                }

                // Period ì„ íƒ
                if (period === 'ë‹¨ê¸°') {
                    document.querySelector('input[name="period"][value="ë‹¨ê¸°"]').checked = true;
                } else {
                    document.querySelector('input[name="period"][value="ì¤‘ê¸°"]').checked = true;
                }

                // Risk ì„ íƒ
                const riskMapping = {
                    'conservative': 'ë³´ìˆ˜',
                    'middle': 'ì¤‘ë¦½',
                    'aggressive': 'ê³µê²©'
                };
                const riskKorean = riskMapping[risk] || 'ì¤‘ë¦½';
                const riskRadio = document.querySelector(`input[name="risk"][value="${riskKorean}"]`);
                if (riskRadio) {
                    riskRadio.checked = true;
                }

                // Capital ì„¤ì •
                document.getElementById('capital').value = capital;

                // Sector ë“œë¡­ë‹¤ìš´ì— ì„ íƒëœ ì„¹í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                const sectorSelect = document.getElementById('sector');
                const sectorExists = Array.from(sectorSelect.options).some(opt => opt.value === sector);
                
                if (sectorExists) {
                    // ì„¹í„°ê°€ ì¡´ì¬í•˜ë©´ ì„ íƒ
                    sectorSelect.value = sector;
                    
                    // ì¢…ëª© ì˜µì…˜ ìƒì„±
                    const stockSelect = document.getElementById('stock');
                    stockSelect.innerHTML = '<option value="">-- ì¢…ëª© ì„ íƒ --</option>';
                    
                    if (STOCK_DATABASE[sector]) {
                        STOCK_DATABASE[sector].forEach(stock => {
                            const option = document.createElement('option');
                            option.value = stock.ticker;
                            option.textContent = `${stock.name} (${stock.ticker})`;
                            option.dataset.price = stock.price;
                            option.dataset.name = stock.name;
                            stockSelect.appendChild(option);
                        });
                    }

                    // íŠ¹ì • ì¢…ëª©ì´ DBì— ìˆëŠ”ì§€ í™•ì¸
                    const stockInDB = STOCK_DATABASE[sector]?.find(s => s.ticker === ticker);
                    
                    if (stockInDB) {
                        // DBì— ìˆìœ¼ë©´ ì„ íƒ
                        stockSelect.value = ticker;
                        document.getElementById('current-price').value = stockInDB.price;
                    } else if (name && ticker && price) {
                        // DBì— ì—†ìœ¼ë©´ ìˆ˜ë™ìœ¼ë¡œ ì˜µì…˜ ì¶”ê°€
                        const option = document.createElement('option');
                        option.value = ticker;
                        option.textContent = `${name} (${ticker})`;
                        option.dataset.price = price;
                        option.dataset.name = name;
                        option.selected = true;
                        stockSelect.appendChild(option);
                        document.getElementById('current-price').value = price;
                    }
                } else {
                    // ì„¹í„°ê°€ ë“œë¡­ë‹¤ìš´ì— ì—†ìœ¼ë©´ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€
                    const sectorOption = document.createElement('option');
                    sectorOption.value = sector;
                    sectorOption.textContent = sector;
                    sectorOption.selected = true;
                    sectorSelect.appendChild(sectorOption);
                    
                    // ì¢…ëª©ë„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€
                    const stockSelect = document.getElementById('stock');
                    stockSelect.innerHTML = '';
                    const stockOption = document.createElement('option');
                    stockOption.value = ticker;
                    stockOption.textContent = `${name} (${ticker})`;
                    stockOption.dataset.price = price;
                    stockOption.dataset.name = name;
                    stockOption.selected = true;
                    stockSelect.appendChild(stockOption);
                    document.getElementById('current-price').value = price;
                }

                // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
                const alertDiv = document.querySelector('.alert.info');
                if (alertDiv) {
                    // í†µí™” ê¸°í˜¸ ê²°ì •
                    const isUSStock = market === 'US';
                    const currencySymbol = isUSStock ? '$' : 'â‚©';
                    const formattedPrice = isUSStock ? price.toFixed(2) : price.toLocaleString();
                    
                    alertDiv.innerHTML = `
                        <strong>âœ… Decision Streamì—ì„œ ì—°ê²°ë¨!</strong><br>
                        <strong>${name} (${ticker})</strong> ì¢…ëª©ì´ ìë™ìœ¼ë¡œ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                        ì„¹í„°: ${sector} | í˜„ì¬ê°€: ${currencySymbol}${formattedPrice} | ê¸°ê°„: ${period} | ë¦¬ìŠ¤í¬: ${risk}<br>
                        <span style="opacity: 0.8;">ì•„ë˜ "ë§¤ë§¤ ê³„íš ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒì„¸ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.</span>
                    `;
                    alertDiv.className = 'alert success';
                    alertDiv.style.background = 'rgba(72, 187, 120, 0.2)';
                    alertDiv.style.borderLeftColor = '#48bb78';
                    alertDiv.style.color = '#9ae6b4';
                    
                    // ìŠ¤í¬ë¡¤í•˜ì—¬ ì•Œë¦¼ ë³´ì´ê¸°
                    alertDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                // ëŒì•„ê°€ê¸° ë²„íŠ¼ í‘œì‹œ
                const backButton = document.getElementById('back-to-index-btn');
                if (backButton) {
                    backButton.style.display = 'block';
                }

                console.log('âœ… URL Parameters loaded successfully!');
            }
        }

        function setupEventListeners() {
            // Market change - ì‹œì¥ ì„ íƒ ì‹œ ë ˆì´ë¸” ë³€ê²½
            document.querySelectorAll('input[name="market"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const priceLabel = document.getElementById('price-label');
                    const priceInput = document.getElementById('current-price');
                    const capitalLabel = document.getElementById('capital-label');
                    const capitalInput = document.getElementById('capital');
                    
                    if (this.value === 'US') {
                        priceLabel.textContent = 'í˜„ì¬ ì£¼ê°€ ($)';
                        priceInput.placeholder = 'ì˜ˆ: 215.00';
                        capitalLabel.textContent = 'íˆ¬ì ê¸ˆì•¡ ($)';
                        capitalInput.placeholder = 'ì˜ˆ: 10000';
                        capitalInput.value = '10000';
                    } else {
                        priceLabel.textContent = 'í˜„ì¬ ì£¼ê°€ (â‚©)';
                        priceInput.placeholder = 'ì˜ˆ: 75000';
                        capitalLabel.textContent = 'íˆ¬ì ê¸ˆì•¡ (â‚©)';
                        capitalInput.placeholder = 'ì˜ˆ: 5000000';
                        capitalInput.value = '5000000';
                    }
                });
            });
            
            // Sector change
            document.getElementById('sector').addEventListener('change', function() {
                const sector = this.value;
                const stockSelect = document.getElementById('stock');
                const priceInput = document.getElementById('current-price');
                
                // ì¢…ëª© ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                stockSelect.innerHTML = '<option value="">-- ì¢…ëª© ì„ íƒ --</option>';
                // ê°€ê²© í•„ë“œ ì´ˆê¸°í™”
                priceInput.value = '';
                
                if (sector && STOCK_DATABASE[sector]) {
                    STOCK_DATABASE[sector].forEach(stock => {
                        const option = document.createElement('option');
                        option.value = stock.ticker;
                        option.textContent = `${stock.name} (${stock.ticker})`;
                        option.dataset.price = stock.price;
                        option.dataset.name = stock.name;
                        stockSelect.appendChild(option);
                    });
                }
            });

            // Stock change - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (HTMLì˜ onchange ì‚¬ìš©)
            // HTMLì—ì„œ onchange="handleStockChange()"ë¡œ ì²˜ë¦¬ë¨
        }

        // ì°¨íŠ¸ ë¶„ì„ ê¸°ëŠ¥
        function openChartAnalysis() {
            console.log('ğŸ“Š openChartAnalysis called');
            const stockSelect = document.getElementById('stock');
            const ticker = stockSelect.value;
            
            console.log('Current ticker:', ticker);
            
            if (!ticker) {
                alert('ë¨¼ì € ì¢…ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
                console.log('âŒ No ticker selected');
                return;
            }
            
            // ì°¨íŠ¸ ë¶„ì„ í˜ì´ì§€ URL
            const chartUrl = `chart_analysis.html?ticker=${ticker}`;
            console.log('Opening chart URL:', chartUrl);
            
            try {
                const newWindow = window.open(chartUrl, '_blank');
                if (newWindow) {
                    console.log('âœ… Chart window opened successfully');
                } else {
                    console.log('âŒ Popup blocked or failed to open');
                    alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ íŒì—… ì°¨ë‹¨ì„ í•´ì œí•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('Error opening chart:', error);
                alert('ì°¨íŠ¸ ë¶„ì„ í˜ì´ì§€ë¥¼ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë””ë²„ê¹… í•¨ìˆ˜: í˜„ì¬ ì¢…ëª© ì •ë³´ í™•ì¸
        function debugStockInfo() {
            const stockSelect = document.getElementById('stock');
            const selectedOption = stockSelect.options[stockSelect.selectedIndex];
            
            console.log('=== ì¢…ëª© ë””ë²„ê¹… ì •ë³´ ===');
            console.log('Selected index:', stockSelect.selectedIndex);
            console.log('Selected value:', stockSelect.value);
            console.log('Selected option:', selectedOption);
            console.log('Option text:', selectedOption?.textContent);
            console.log('Dataset price:', selectedOption?.dataset.price);
            console.log('Dataset name:', selectedOption?.dataset.name);
            console.log('Current price input:', document.getElementById('current-price').value);
            console.log('======================');
        }

        // ì¢…ëª© ì„ íƒ í•¸ë“¤ëŸ¬ (ì¸ë¼ì¸ ì´ë²¤íŠ¸)
        function handleStockChange() {
            console.log('ğŸ”µ handleStockChange called');
            const stockSelect = document.getElementById('stock');
            const selectedOption = stockSelect.options[stockSelect.selectedIndex];
            const priceInput = document.getElementById('current-price');
            const debugInfo = document.getElementById('debug-info');
            const debugText = document.getElementById('debug-text');
            
            // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
            debugInfo.style.display = 'block';
            let debugMsg = '';
            
            console.log('Selected option:', selectedOption);
            console.log('Selected value:', stockSelect.value);
            console.log('Dataset price:', selectedOption?.dataset?.price);
            
            debugMsg += `ì„ íƒ ì¸ë±ìŠ¤: ${stockSelect.selectedIndex}<br>`;
            debugMsg += `ì„ íƒ ê°’: ${stockSelect.value}<br>`;
            debugMsg += `ì˜µì…˜ í…ìŠ¤íŠ¸: ${selectedOption?.textContent}<br>`;
            debugMsg += `Dataset.price: ${selectedOption?.dataset?.price || 'ì—†ìŒ'}<br>`;
            
            // ì¢…ëª©ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°
            if (!stockSelect.value) {
                console.log('No stock selected');
                priceInput.value = '';
                debugMsg += `<span style="color: #fc8181;">âŒ ì¢…ëª© ì„ íƒ ì•ˆë¨</span>`;
                debugText.innerHTML = debugMsg;
                return;
            }
            
            // dataset.priceê°€ ìˆëŠ” ê²½ìš° ìë™ ì…ë ¥
            if (selectedOption && selectedOption.dataset && selectedOption.dataset.price) {
                const price = selectedOption.dataset.price;
                console.log('âœ… Setting price to:', price);
                priceInput.value = price;
                debugMsg += `<span style="color: #48bb78;">âœ… ì£¼ê°€ ìë™ ì…ë ¥: ${price}</span>`;
            } else {
                console.log('âŒ No price found in dataset');
                priceInput.value = '';
                debugMsg += `<span style="color: #fc8181;">âŒ Datasetì— ê°€ê²© ì—†ìŒ</span>`;
            }
            
            debugText.innerHTML = debugMsg;
        }

        async function generateTradePlan() {
            // Validate inputs
            const market = document.querySelector('input[name="market"]:checked').value;
            const sector = document.getElementById('sector').value;
            const stock = document.getElementById('stock').value;
            const stockName = document.getElementById('stock').options[document.getElementById('stock').selectedIndex]?.dataset.name || '';
            const currentPrice = parseFloat(document.getElementById('current-price').value);
            const period = document.querySelector('input[name="period"]:checked').value;
            const risk = document.querySelector('input[name="risk"]:checked').value;
            const capital = parseFloat(document.getElementById('capital').value);
            const entryStrategy = parseFloat(document.querySelector('input[name="entry"]:checked').value) / 100;

            if (!sector || !stock || !currentPrice || !capital) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¯¸êµ­ ì£¼ì‹ íŒë³„
            // 1. í‹°ì»¤ê°€ 4ì ì´í•˜ì´ë©´ì„œ ìˆ«ìë¡œë§Œ ì´ë£¨ì–´ì§€ì§€ ì•ŠìŒ (ì˜ˆ: LMT, JNJ)
            // 2. ë˜ëŠ” ì‹œì¥ì—ì„œ 'US' ì„ íƒë¨
            const isUSStock = (stock.length <= 4 && !/^\d+$/.test(stock)) || market === 'US';
            
            console.log('ğŸ” Market:', market);
            console.log('ğŸ” Stock:', stock);
            console.log('ğŸ” isUSStock:', isUSStock);

            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').style.display = 'none';

            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 1500));

            // Calculate trade plan
            const plan = calculateTradePlan(currentPrice, risk, capital, period, isUSStock, entryStrategy);

            // Display results (ì¤‘ë³µ í˜¸ì¶œ ì œê±°!)
            displayResults(plan, stockName, stock, isUSStock);

            // Save to history
            saveSimulation({
                date: new Date(),
                market,
                sector,
                ticker: stock,
                name: stockName,
                currentPrice,
                period,
                risk,
                capital,
                plan
            });

            // Hide loading
            document.getElementById('loading').classList.remove('active');
            document.getElementById('results').style.display = 'block';
        }

        function calculateTradePlan(currentPrice, risk, capital, period, isUSStock = false, entryStrategy = 1.0) {
            // Risk-based parameters
            const riskParams = {
                'ë³´ìˆ˜': { stopLoss: 0.08, target1: 0.15, target2: 0.25, positionSize: 0.20 },
                'ì¤‘ë¦½': { stopLoss: 0.10, target1: 0.20, target2: 0.35, positionSize: 0.25 },
                'ê³µê²©': { stopLoss: 0.12, target1: 0.25, target2: 0.45, positionSize: 0.30 }
            };

            const params = riskParams[risk];

            // Entry with user-selected strategy (100% = immediate, 98% = wait for 2% dip, 95% = wait for 5% dip)
            const entryPrice = isUSStock ? parseFloat((currentPrice * entryStrategy).toFixed(2)) : Math.round(currentPrice * entryStrategy);
            const stopLoss = isUSStock ? parseFloat((entryPrice * (1 - params.stopLoss)).toFixed(2)) : Math.round(entryPrice * (1 - params.stopLoss));
            const target1 = isUSStock ? parseFloat((entryPrice * (1 + params.target1)).toFixed(2)) : Math.round(entryPrice * (1 + params.target1));
            const target2 = isUSStock ? parseFloat((entryPrice * (1 + params.target2)).toFixed(2)) : Math.round(entryPrice * (1 + params.target2));

            // Position sizing
            const positionValue = Math.round(capital * params.positionSize);
            const quantity = Math.floor(positionValue / entryPrice);
            const actualInvestment = isUSStock ? parseFloat((quantity * entryPrice).toFixed(2)) : quantity * entryPrice;

            // Calculate P&L
            const maxLoss = isUSStock ? parseFloat(((entryPrice - stopLoss) * quantity).toFixed(2)) : Math.round((entryPrice - stopLoss) * quantity);
            const expectedProfit1 = isUSStock ? parseFloat(((target1 - entryPrice) * quantity * 0.5).toFixed(2)) : Math.round((target1 - entryPrice) * quantity * 0.5);
            const expectedProfit2 = isUSStock ? parseFloat(((target2 - entryPrice) * quantity * 0.3).toFixed(2)) : Math.round((target2 - entryPrice) * quantity * 0.3);

            return {
                entryPrice,
                stopLoss,
                target1,
                target2,
                quantity,
                positionSize: params.positionSize,
                actualInvestment,
                maxLoss,
                expectedProfit: isUSStock ? parseFloat((expectedProfit1 + expectedProfit2).toFixed(2)) : expectedProfit1 + expectedProfit2,
                riskRewardRatio: ((expectedProfit1 + expectedProfit2) / maxLoss).toFixed(2)
            };
        }

        function displayResults(plan, stockName, ticker, isUSStock = false) {
            console.log('ğŸ’° displayResults called');
            console.log('ğŸ’° isUSStock:', isUSStock);
            console.log('ğŸ’° ticker:', ticker);
            
            // ì‹œì¥ ì •ë³´ í‘œì‹œ
            const marketDisplay = document.getElementById('market-display');
            if (isUSStock) {
                marketDisplay.innerHTML = 'ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì‹œì¥ (USD)';
                marketDisplay.style.color = '#48bb78';
            } else {
                marketDisplay.innerHTML = 'ğŸ‡°ğŸ‡· í•œêµ­ ì‹œì¥ (KRW)';
                marketDisplay.style.color = '#667eea';
            }
            
            // í†µí™” ê¸°í˜¸ ë° í¬ë§·
            const currency = isUSStock ? '$' : 'â‚©';
            const formatPrice = (price) => {
                if (isUSStock) {
                    return `${currency}${price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                } else {
                    return `${currency}${price.toLocaleString()}`;
                }
            };
            
            console.log('ğŸ’° Currency:', currency);
            console.log('ğŸ’° Sample format:', formatPrice(plan.entryPrice));
            
            // Price info
            document.getElementById('entry-price').textContent = formatPrice(plan.entryPrice);
            document.getElementById('stop-loss').textContent = `${formatPrice(plan.stopLoss)} (-${((plan.entryPrice - plan.stopLoss) / plan.entryPrice * 100).toFixed(1)}%)`;
            document.getElementById('target-1').textContent = `${formatPrice(plan.target1)} (+${((plan.target1 - plan.entryPrice) / plan.entryPrice * 100).toFixed(1)}%)`;
            document.getElementById('target-2').textContent = `${formatPrice(plan.target2)} (+${((plan.target2 - plan.entryPrice) / plan.entryPrice * 100).toFixed(1)}%)`;

            // Position info
            document.getElementById('quantity').textContent = `${plan.quantity.toLocaleString()}ì£¼`;
            document.getElementById('position-size').textContent = `${(plan.positionSize * 100).toFixed(0)}% (${formatPrice(plan.actualInvestment)})`;
            document.getElementById('max-loss').textContent = `-${formatPrice(plan.maxLoss)}`;
            document.getElementById('expected-profit').textContent = `+${formatPrice(plan.expectedProfit)}`;

            // Checklist (7 factors) - ticker ê¸°ë°˜ ì¼ê´€ì„± ìˆëŠ” ì ìˆ˜
            // ê°™ì€ ì¢…ëª©ì€ í•­ìƒ ê°™ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë°˜í™˜
            const checklistSeed = ticker.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            
            // ì‹œë“œ ê¸°ë°˜ ì˜ì‚¬ ëœë¤ í•¨ìˆ˜
            function seededRandom(index) {
                const x = Math.sin(checklistSeed + index) * 10000;
                return x - Math.floor(x);
            }
            
            const checklistItems = [
                { name: 'ìˆ˜ê¸‰ ì‹ í˜¸', pass: seededRandom(1) > 0.3, detail: 'ì™¸êµ­ì¸/ê¸°ê´€ ëˆ„ì  ë§¤ìˆ˜ í™•ì¸' },
                { name: 'ì •ì±…/í…Œë§ˆ', pass: seededRandom(2) > 0.4, detail: 'í™•ì •Â·ì§€ì†Â·ì‹¤ì ì—°ê²° ë‰´ìŠ¤' },
                { name: 'ì‹œì¥ ì‚¬ì´í´', pass: seededRandom(3) > 0.2, detail: 'MA20 ìƒí–¥, ë³€ë™ì„± ì •ìƒ' },
                { name: 'ê¸°ì—… ì§ˆ', pass: seededRandom(4) > 0.3, detail: 'ë¶€ì±„ë¹„ìœ¨, ì‹¤ì  ì•ˆì •ì„±' },
                { name: 'ì„œì‚¬', pass: seededRandom(5) > 0.5, detail: 'ì¥ê¸° ì„±ì¥ ìŠ¤í† ë¦¬ ì¡´ì¬' },
                { name: 'í•˜ë°© ë¦¬ìŠ¤í¬', pass: seededRandom(6) > 0.6, detail: 'ê³¼ì—´ ì‹ í˜¸ ì—†ìŒ' },
                { name: 'ì‹œê°„ ì í•©ì„±', pass: seededRandom(7) > 0.4, detail: 'ì¡°ì • í›„ ì§„ì… êµ¬ê°„' }
            ];
            
            console.log(`ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„± (${ticker}): ${checklistItems.filter(i => i.pass).length}/7 í†µê³¼`);

            const checklistHtml = checklistItems.map(item => `
                <div class="checklist-item ${item.pass ? 'pass' : 'fail'}">
                    <span class="icon">${item.pass ? 'âœ…' : 'âŒ'}</span>
                    <span class="text"><strong>${item.name}:</strong> ${item.detail}</span>
                    <span class="status ${item.pass ? 'green' : 'red'}">${item.pass ? 'PASS' : 'FAIL'}</span>
                </div>
            `).join('');
            document.getElementById('checklist-items').innerHTML = checklistHtml;

            // Risk warning
            const passCount = checklistItems.filter(i => i.pass).length;
            let riskWarning = '';
            if (passCount >= 6) {
                riskWarning = 'ì²´í¬ë¦¬ìŠ¤íŠ¸ í†µê³¼! ì†ì ˆê°€ë¥¼ ì—„ìˆ˜í•˜ê³  20ì¼ì„  ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.';
            } else if (passCount >= 4) {
                riskWarning = 'ì¼ë¶€ ì¡°ê±´ ë¯¸ë‹¬. í¬ì§€ì…˜ í¬ê¸°ë¥¼ ì¤„ì´ê³  ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•˜ì„¸ìš”.';
            } else {
                riskWarning = 'âš ï¸ ì§„ì… ì¡°ê±´ ë¯¸ë‹¬! ê´€ë§ì„ ê¶Œì¥í•©ë‹ˆë‹¤.';
            }
            document.getElementById('risk-warning').textContent = riskWarning;
        }

        function saveSimulation(sim) {
            // ì‹œì¥ ì •ë³´ ì €ì¥ (ì´ë¯¸ ìˆìœ¼ë©´ ìœ ì§€, ì—†ìœ¼ë©´ ì‹œì¥ ë“œë¡­ë‹¤ìš´ ê°’ ì‚¬ìš©)
            if (!sim.market) {
                sim.market = document.getElementById('market').value;
            }
            simulationHistory.unshift(sim);
            if (simulationHistory.length > 20) {
                simulationHistory = simulationHistory.slice(0, 20);
            }
            localStorage.setItem('trade_simulations', JSON.stringify(simulationHistory));
            updateHistoryTable();
            updateStats();
        }

        function loadSimulationHistory() {
            const saved = localStorage.getItem('trade_simulations');
            if (saved) {
                simulationHistory = JSON.parse(saved);
                updateHistoryTable();
                updateStats();
            }
        }

        function updateHistoryTable() {
            const tbody = document.getElementById('history-body');
            
            if (simulationHistory.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #a0aec0; padding: 40px;">ì•„ì§ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = simulationHistory.map(sim => {
                const date = new Date(sim.date);
                const status = Math.random() > 0.4 ? 'ì§„í–‰ì¤‘' : (Math.random() > 0.5 ? 'ìµì ˆ' : 'ì†ì ˆ');
                const pnl = status === 'ìµì ˆ' ? (Math.random() * 20 + 5).toFixed(1) : 
                            status === 'ì†ì ˆ' ? -(Math.random() * 10 + 3).toFixed(1) : 
                            (Math.random() * 10 - 5).toFixed(1);
                
                // ë¯¸êµ­ ì£¼ì‹ ì—¬ë¶€ í™•ì¸
                const isUSStock = sim.market === 'US' || (sim.ticker && sim.ticker.length <= 4 && !/^[0-9]+$/.test(sim.ticker));
                const currencySymbol = isUSStock ? '$' : 'â‚©';
                const priceFormat = isUSStock ? 
                    (val) => val.toFixed(2) : 
                    (val) => val.toLocaleString();
                
                return `
                    <tr>
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td><strong>${sim.name}</strong><br><small>${sim.ticker}</small></td>
                        <td>${currencySymbol}${priceFormat(sim.plan.entryPrice)}</td>
                        <td>${currencySymbol}${priceFormat(sim.plan.stopLoss)} / ${currencySymbol}${priceFormat(sim.plan.target1)}</td>
                        <td>${sim.risk} | ${sim.period}</td>
                        <td class="${pnl > 0 ? 'green' : pnl < 0 ? 'red' : ''}" style="font-weight: 600;">
                            ${pnl > 0 ? '+' : ''}${pnl}%
                        </td>
                        <td>
                            <span class="badge ${status === 'ìµì ˆ' ? 'success' : status === 'ì†ì ˆ' ? 'danger' : 'warning'}">
                                ${status}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateStats() {
            const total = simulationHistory.length;
            document.getElementById('total-sims').textContent = total;

            if (total > 0) {
                // Mock stats (in real app, calculate from actual results)
                const winRate = (Math.random() * 30 + 50).toFixed(0);
                const avgReturn = (Math.random() * 10 + 2).toFixed(1);
                const profitRatio = `${(Math.random() * 1.5 + 1.5).toFixed(1)}:1`;

                document.getElementById('win-rate').textContent = `${winRate}%`;
                document.getElementById('avg-return').textContent = `+${avgReturn}%`;
                document.getElementById('profit-ratio').textContent = profitRatio;
            }
        }

        function resetForm() {
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('sector').value = '';
            document.getElementById('stock').innerHTML = '<option value="">-- ë¨¼ì € ì„¹í„°ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>';
            document.getElementById('current-price').value = '';
            document.getElementById('capital').value = '5000000';
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ˆê¸°í™”
            document.querySelector('input[name="market"][value="KR"]').checked = true;
            document.querySelector('input[name="period"][value="ë‹¨ê¸°"]').checked = true;
            document.querySelector('input[name="risk"][value="ë³´ìˆ˜"]').checked = true;
            
            // ì•Œë¦¼ ë©”ì‹œì§€ ì´ˆê¸°í™” (ì›ë˜ ë©”ì‹œì§€ë¡œ ë³µì›)
            const alertDiv = document.querySelector('.alert');
            if (alertDiv) {
                alertDiv.innerHTML = '<strong>ğŸ’¡ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ:</strong> ì‹¤ì œ ë§¤ë§¤ ì—†ì´ ì•ˆì „í•˜ê²Œ ì—°ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                alertDiv.className = 'alert info';
            }
            
            // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸° ë° ì´ˆê¸°í™”
            document.getElementById('results').style.display = 'none';
            
            // ê²°ê³¼ ê°’ë“¤ ì´ˆê¸°í™”
            document.getElementById('entry-price').textContent = '-';
            document.getElementById('stop-loss').textContent = '-';
            document.getElementById('target-1').textContent = '-';
            document.getElementById('target-2').textContent = '-';
            document.getElementById('quantity').textContent = '-';
            document.getElementById('position-size').textContent = '-';
            document.getElementById('max-loss').textContent = '-';
            document.getElementById('expected-profit').textContent = '-';
            
            // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
            const checklistContainer = document.getElementById('checklist-items');
            if (checklistContainer) {
                checklistContainer.innerHTML = '';
            }
            
            // ê²½ê³  ë©”ì‹œì§€ ì´ˆê¸°í™”
            const riskWarning = document.getElementById('risk-warning');
            if (riskWarning) {
                riskWarning.textContent = '';
            }
            
            console.log('Form reset completed');
        }
    </script>
</body>
</html>
