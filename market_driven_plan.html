<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market-Driven Trade Plan | Decision Stream</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #e8eaed;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p {
            color: #a0aec0;
            font-size: 14px;
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .refresh-btn {
            margin-left: auto;
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .regime-box {
            background: rgba(72, 187, 120, 0.1);
            border: 2px solid #48bb78;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .regime-box.risk-off {
            background: rgba(245, 101, 101, 0.1);
            border-color: #f56565;
        }
        .regime-title {
            font-size: 24px;
            font-weight: 700;
            color: #48bb78;
            margin-bottom: 8px;
        }
        .regime-box.risk-off .regime-title {
            color: #f56565;
        }
        .regime-score {
            font-size: 18px;
            color: #a0aec0;
            margin-bottom: 8px;
        }
        .regime-playbook {
            font-size: 16px;
            color: #fff;
            font-weight: 600;
        }
        .sector-list {
            margin-top: 16px;
        }
        .sector-item {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sector-item:hover {
            background: rgba(0,0,0,0.5);
            transform: translateX(4px);
        }
        .sector-item.surge {
            border-left: 4px solid #48bb78;
        }
        .sector-item.normal {
            border-left: 4px solid #718096;
        }
        .sector-name {
            font-size: 15px;
            font-weight: 600;
        }
        .sector-score {
            font-size: 14px;
            color: #a0aec0;
        }
        .sector-signal {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .sector-signal.surge {
            background: rgba(72, 187, 120, 0.2);
            color: #48bb78;
        }
        .sector-signal.normal {
            background: rgba(113, 128, 150, 0.2);
            color: #cbd5e0;
        }
        .funnel-section {
            margin-top: 20px;
        }
        .funnel-group {
            margin-bottom: 20px;
        }
        .funnel-label {
            font-size: 13px;
            font-weight: 600;
            color: #a0aec0;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .stock-item {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .stock-item:hover {
            background: rgba(102, 126, 234, 0.2);
        }
        .stock-item.leader {
            border-left: 4px solid #667eea;
        }
        .stock-item.follower {
            border-left: 4px solid #ecc94b;
        }
        .stock-item.nogo {
            border-left: 4px solid #f56565;
            opacity: 0.5;
        }
        .stock-name {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
        }
        .stock-ticker {
            font-size: 12px;
            color: #a0aec0;
            margin-left: 8px;
        }
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
        }
        .alert.info {
            background: rgba(66, 153, 225, 0.2);
            border-left: 3px solid #4299e1;
            color: #90cdf4;
        }
        .alert.success {
            background: rgba(72, 187, 120, 0.2);
            border-left: 3px solid #48bb78;
            color: #9ae6b4;
        }
        .alert.warning {
            background: rgba(236, 201, 75, 0.2);
            border-left: 3px solid #ecc94b;
            color: #faf089;
        }
        .alert.danger {
            background: rgba(245, 101, 101, 0.2);
            border-left: 3px solid #f56565;
            color: #fc8181;
        }
        .strategy-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .strategy-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 12px;
        }
        .strategy-desc {
            font-size: 14px;
            color: #cbd5e0;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        .strategy-points {
            list-style: none;
        }
        .strategy-points li {
            font-size: 13px;
            color: #a0aec0;
            padding: 6px 0;
            padding-left: 24px;
            position: relative;
        }
        .strategy-points li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: 600;
        }
        .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 16px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¯ Market-Driven Trade Plan</h1>
            <p>ì‹œì¥ ìƒí™© ë¶„ì„ â†’ ì„¹í„° ì„ íƒ â†’ ì¢…ëª© ì„ íƒ â†’ ë§¤ë§¤ ê³„íš ìë™ ìƒì„±</p>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left: Market Analysis -->
            <div class="card">
                <div class="card-title">
                    <span>ğŸ“Š</span>
                    ì‹œì¥ ë¶„ì„
                    <button id="refresh-btn" class="refresh-btn">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>

                <!-- Market Regime -->
                <div id="regime-display" class="regime-box">
                    <div class="regime-title">RISK_ON</div>
                    <div class="regime-score">Risk Score: <strong>72</strong>/100</div>
                    <div class="regime-playbook">ğŸ“‹ Playbook: ëˆŒë¦¼ ë§¤ìˆ˜</div>
                </div>

                <div id="regime-alert" class="alert success">
                    <strong>âœ… ìµœì ì˜ í™˜ê²½!</strong><br>
                    ìê¸ˆì´ ìœ„í—˜ìì‚°(ì£¼ì‹)ìœ¼ë¡œ ìœ ì…ë˜ëŠ” êµ­ë©´ì…ë‹ˆë‹¤. ì¡°ì • í›„ ì¬ì§„ì… ì „ëµì´ ê°€ì¥ ìœ ë¦¬í•©ë‹ˆë‹¤.
                </div>

                <!-- Sector Heatmap -->
                <div class="card-title" style="margin-top: 24px;">
                    <span>ğŸŒ¡ï¸</span>
                    ì„¹í„° íˆíŠ¸ë§µ
                </div>

                <div class="sector-list" id="sector-list">
                    <!-- Dynamically generated -->
                </div>

                <div class="alert info" style="margin-top: 16px;">
                    <strong>ğŸ’¡ SURGE ì˜ë¯¸:</strong> í˜„ì¬ ì´ ìˆœê°„ ìê¸ˆì´ ëª°ë¦¬ëŠ” ê³³ì…ë‹ˆë‹¤. ë‹¨ìˆœ ê°•ì„¸ê°€ ì•„ë‹™ë‹ˆë‹¤.
                </div>
            </div>

            <!-- Right: Trade Plan -->
            <div class="card">
                <div class="card-title">
                    <span>ğŸ“</span>
                    ë§¤ë§¤ ê³„íš ìƒì„±
                </div>

                <div id="no-selection-alert" class="alert warning">
                    <strong>â¬…ï¸ ì™¼ìª½ì—ì„œ ì„¹í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”</strong><br>
                    SURGE ì„¹í„°ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì„¹í„°ì˜ Stock Funnelì´ í‘œì‹œë©ë‹ˆë‹¤.
                </div>

                <div id="funnel-display" style="display: none;">
                    <!-- Selected Sector Info -->
                    <div id="selected-sector-info"></div>

                    <!-- Stock Funnel -->
                    <div class="funnel-section">
                        <div class="funnel-group">
                            <div class="funnel-label">ğŸ† Leader (ì„ ë„ì£¼)</div>
                            <div id="leader-stocks"></div>
                        </div>

                        <div class="funnel-group">
                            <div class="funnel-label">ğŸ“ˆ Follower (ì¶”ì¢…ì£¼)</div>
                            <div id="follower-stocks"></div>
                        </div>

                        <div class="funnel-group">
                            <div class="funnel-label">ğŸš« No-Go (ì§„ì… ê¸ˆì§€)</div>
                            <div id="nogo-stocks"></div>
                        </div>
                    </div>

                    <!-- Strategy Recommendation -->
                    <div id="strategy-recommendation"></div>

                    <!-- Action Button -->
                    <button class="btn btn-primary" id="generate-plan-btn" onclick="generateTradePlan()">
                        ğŸš€ ë§¤ë§¤ ê³„íš ìë™ ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        // ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© - CORS ë¬¸ì œ í•´ê²°
        const ACCESS_KEY = 'ds-test-2026';

        // Mock data
        const MARKET_DATA = {
            regime: {
                state: 'RISK_ON',
                risk_score: 72,
                playbook: 'ëˆŒë¦¼ ë§¤ìˆ˜',
                volatility: 'ì•ˆì •',
                flow: 'ëŒ€í˜•ì£¼ ìœ ì…'
            },
            sectors: [
                { name: 'ë°©ì‚°', score: 97, signal: 'SURGE', duration: '2ì£¼ ì§€ì†' },
                { name: 'í—¬ìŠ¤ì¼€ì–´', score: 96, signal: 'SURGE', duration: '1ì£¼ ì§€ì†' },
                { name: 'AI ë°˜ë„ì²´', score: 46, signal: 'NORMAL', duration: '-' },
                { name: 'ì „ë ¥', score: 45, signal: 'NORMAL', duration: '-' },
                { name: 'ì—ë„ˆì§€', score: 8, signal: 'NORMAL', duration: '-' }
            ],
            funnels: {
                'ë°©ì‚°': {
                    leader: [],
                    follower: [
                        { ticker: 'LMT', name: 'Lockheed Martin', price: 445.50 },
                        { ticker: '012450', name: 'í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤', price: 185000 }
                    ],
                    nogo: []
                },
                'í—¬ìŠ¤ì¼€ì–´': {
                    leader: [
                        { ticker: 'JNJ', name: 'Johnson & Johnson', price: 158.25 }
                    ],
                    follower: [],
                    nogo: []
                },
                'AI ë°˜ë„ì²´': {
                    leader: [],
                    follower: [
                        { ticker: '005930', name: 'ì‚¼ì„±ì „ì', price: 75000 }
                    ],
                    nogo: []
                }
            }
        };

        let selectedSector = null;
        let selectedStock = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderMarketRegime();
            renderSectorList();
            
            // Add refresh button event listener
            document.getElementById('refresh-btn').addEventListener('click', function() {
                const btn = this;
                btn.textContent = 'â³ ìƒˆë¡œê³ ì¹¨ ì¤‘...';
                btn.disabled = true;
                
                // Simulate refresh (1 second delay)
                setTimeout(() => {
                    renderMarketRegime();
                    renderSectorList();
                    btn.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
                    btn.disabled = false;
                    
                    // Show success message
                    const regimeAlert = document.getElementById('regime-alert');
                    const originalHTML = regimeAlert.innerHTML;
                    const originalClass = regimeAlert.className;
                    
                    regimeAlert.className = 'alert success';
                    regimeAlert.innerHTML = '<strong>âœ… ì‹œì¥ ë¶„ì„ ì—…ë°ì´íŠ¸ ì™„ë£Œ!</strong><br>ìµœì‹  ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    
                    setTimeout(() => {
                        regimeAlert.innerHTML = originalHTML;
                        regimeAlert.className = originalClass;
                    }, 2000);
                }, 1000);
            });
        });

        function renderMarketRegime() {
            const regime = MARKET_DATA.regime;
            const regimeBox = document.getElementById('regime-display');
            const regimeAlert = document.getElementById('regime-alert');

            if (regime.state === 'RISK_OFF') {
                regimeBox.classList.add('risk-off');
                regimeAlert.className = 'alert danger';
                regimeAlert.innerHTML = `
                    <strong>ğŸš« ì§„ì… ê¸ˆì§€!</strong><br>
                    ìê¸ˆì´ ì£¼ì‹ ì‹œì¥ì—ì„œ ë¹ ì ¸ë‚˜ê°€ëŠ” êµ­ë©´ì…ë‹ˆë‹¤. ì‹ ê·œ ì§„ì…ì„ ì¤‘ë‹¨í•˜ê³  í˜„ê¸ˆ ë¹„ì¤‘ì„ í™•ë³´í•˜ì„¸ìš”.
                `;
            } else {
                regimeBox.classList.remove('risk-off');
                regimeAlert.className = 'alert success';
                regimeAlert.innerHTML = `
                    <strong>âœ… ìµœì ì˜ í™˜ê²½!</strong><br>
                    ìê¸ˆì´ ìœ„í—˜ìì‚°(ì£¼ì‹)ìœ¼ë¡œ ìœ ì…ë˜ëŠ” êµ­ë©´ì…ë‹ˆë‹¤. ì¡°ì • í›„ ì¬ì§„ì… ì „ëµì´ ê°€ì¥ ìœ ë¦¬í•©ë‹ˆë‹¤.
                `;
            }

            regimeBox.innerHTML = `
                <div class="regime-title">${regime.state}</div>
                <div class="regime-score">Risk Score: <strong>${regime.risk_score}</strong>/100</div>
                <div class="regime-playbook">ğŸ“‹ Playbook: ${regime.playbook}</div>
            `;
        }

        function renderSectorList() {
            const sectorList = document.getElementById('sector-list');
            
            sectorList.innerHTML = MARKET_DATA.sectors.map(sector => `
                <div class="sector-item ${sector.signal.toLowerCase()}" onclick="selectSector('${sector.name}')">
                    <div>
                        <div class="sector-name">${sector.name}</div>
                        <div class="sector-score">Score: ${sector.score} | ${sector.duration}</div>
                    </div>
                    <span class="sector-signal ${sector.signal.toLowerCase()}">${sector.signal}</span>
                </div>
            `).join('');
        }

        function selectSector(sectorName) {
            selectedSector = sectorName;
            selectedStock = null;
            
            const sector = MARKET_DATA.sectors.find(s => s.name === sectorName);
            const funnel = MARKET_DATA.funnels[sectorName];

            if (!funnel) {
                alert('í•´ë‹¹ ì„¹í„°ì˜ Stock Funnel ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // Hide no-selection alert, show funnel
            document.getElementById('no-selection-alert').style.display = 'none';
            document.getElementById('funnel-display').style.display = 'block';

            // Render sector info
            document.getElementById('selected-sector-info').innerHTML = `
                <div class="alert ${sector.signal === 'SURGE' ? 'success' : 'warning'}">
                    <strong>${sector.name} ì„¹í„°</strong> | Score: ${sector.score} | ${sector.signal}
                </div>
            `;

            // Render stocks
            renderStockList('leader', funnel.leader);
            renderStockList('follower', funnel.follower);
            renderStockList('nogo', funnel.nogo);

            // Render strategy recommendation
            renderStrategy(sectorName, sector, funnel);
        }

        function renderStockList(type, stocks) {
            const container = document.getElementById(`${type}-stocks`);
            
            if (stocks.length === 0) {
                container.innerHTML = '<div style="color: #718096; font-size: 13px; padding: 8px;">ì—†ìŒ</div>';
                return;
            }

            container.innerHTML = stocks.map(stock => `
                <div class="stock-item ${type}" onclick="selectStock('${stock.ticker}', '${stock.name}', ${stock.price})">
                    <span class="stock-name">${stock.name}</span>
                    <span class="stock-ticker">${stock.ticker}</span>
                </div>
            `).join('');
        }

        function selectStock(ticker, name, price) {
            selectedStock = { ticker, name, price };
            
            // Highlight selected stock
            document.querySelectorAll('.stock-item').forEach(el => {
                el.style.background = 'rgba(0,0,0,0.3)';
            });
            event.target.closest('.stock-item').style.background = 'rgba(102, 126, 234, 0.3)';

            // Enable button
            document.getElementById('generate-plan-btn').disabled = false;
            document.getElementById('generate-plan-btn').textContent = `ğŸš€ ${name} ë§¤ë§¤ ê³„íš ìƒì„±`;
        }

        function renderStrategy(sectorName, sector, funnel) {
            const strategyContainer = document.getElementById('strategy-recommendation');
            
            let strategyHTML = '';

            // Strategy based on Leader/Follower status
            if (funnel.leader.length > 0 && funnel.follower.length === 0) {
                // Leader only
                strategyHTML = `
                    <div class="strategy-card">
                        <div class="strategy-title">ğŸ“ˆ ì¶”ì²œ ì „ëµ: Leader ì¶”ì„¸ ì¶”ì¢…</div>
                        <div class="strategy-desc">
                            <strong>${funnel.leader[0].name}</strong>ê°€ ${sectorName} ì„¹í„°ì˜ ì ˆëŒ€ì  ì„ ë„ì£¼ì…ë‹ˆë‹¤.
                            ë‚˜ë¨¸ì§€ ì¢…ëª©ì€ ì•„ì§ ëª» ë”°ë¼ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.
                        </div>
                        <ul class="strategy-points">
                            <li>ì•ˆì •í˜•, ë°©ì–´í˜• íŠ¸ë ˆì´ë“œì— ìµœì </li>
                            <li>ì¶”ì„¸ ì¶”ì¢… (Trend Following) ì „ëµ</li>
                            <li>í¬ì§€ì…˜ í¬ê¸°: 20% (ë³´ìˆ˜ì )</li>
                            <li>ì†ì ˆ: -8%, ëª©í‘œ: +15-25%</li>
                        </ul>
                    </div>
                `;
            } else if (funnel.leader.length === 0 && funnel.follower.length > 0) {
                // Follower only (ìµœê³ ì˜ ê¸°íšŒ!)
                strategyHTML = `
                    <div class="strategy-card" style="border-color: #48bb78;">
                        <div class="strategy-title">âœ¨ ì¶”ì²œ ì „ëµ: Follower ëˆŒë¦¼ ë§¤ìˆ˜ (ìµœì  íƒ€ì´ë°!)</div>
                        <div class="strategy-desc">
                            ${sectorName} ì„¹í„°ëŠ” ê°•í•˜ì§€ë§Œ ëª…í™•í•œ ì„ ë„ì£¼ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.
                            <strong>ê°€ì¥ ì¢‹ì€ ë§¤ìˆ˜ ê¸°íšŒ ì§ì „ êµ¬ì¡°!</strong>
                        </div>
                        <ul class="strategy-points">
                            <li>ì„¹í„°ê°€ ë¨¼ì € ì›€ì§ì˜€ê³ , ì¢…ëª©ë“¤ì€ ë³¸ê²© ëŒíŒŒ ì „ ë‹¨ê³„</li>
                            <li>MA20 ëˆŒë¦¼ ë§¤ìˆ˜ ëŒ€ê¸° (í˜„ì¬ê°€ì˜ 3-5% í•˜ë½)</li>
                            <li>ê±°ë˜ëŸ‰ ì¦ê°€ í™•ì¸ í›„ ì§„ì…</li>
                            <li>í¬ì§€ì…˜ í¬ê¸°: 20-25%</li>
                            <li>ì†ì ˆ: -10%, ëª©í‘œ: +20-35%</li>
                        </ul>
                    </div>
                `;
            } else if (sector.signal === 'NORMAL') {
                // NORMAL sector
                strategyHTML = `
                    <div class="strategy-card" style="border-color: #ecc94b;">
                        <div class="strategy-title">âš ï¸ ì£¼ì˜: NORMAL ì„¹í„°</div>
                        <div class="strategy-desc">
                            í˜„ì¬ ${sectorName} ì„¹í„°ëŠ” ìê¸ˆ ìœ ì…/ìœ ì¶œì´ ì—†ìŠµë‹ˆë‹¤. 
                            ì´ì „ì— ê°•í–ˆìœ¼ë‚˜ í˜„ì¬ëŠ” ì‰¬ëŠ” êµ¬ê°„ì…ë‹ˆë‹¤.
                        </div>
                        <ul class="strategy-points">
                            <li>ì‹ ê·œ ì§„ì… ë³´ë¥˜ ê¶Œì¥</li>
                            <li>ê¸°ì¡´ ë³´ìœ  ì¢…ëª©ì€ 20ì¼ì„  ê¸°ì¤€ ê´€ë¦¬</li>
                            <li>ë‹¤ìŒ SURGE ì‹ í˜¸ ëŒ€ê¸°</li>
                        </ul>
                    </div>
                `;
            }

            strategyContainer.innerHTML = strategyHTML;
        }

        function generateTradePlan() {
            if (!selectedStock) {
                alert('ì¢…ëª©ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            const sector = MARKET_DATA.sectors.find(s => s.name === selectedSector);
            const funnel = MARKET_DATA.funnels[selectedSector];

            // Determine stock type
            let stockType = 'follower';
            if (funnel.leader.find(s => s.ticker === selectedStock.ticker)) {
                stockType = 'leader';
            } else if (funnel.nogo.find(s => s.ticker === selectedStock.ticker)) {
                alert('ğŸš« No-Go ì¢…ëª©ì€ ì§„ì…ì´ ê¸ˆì§€ë©ë‹ˆë‹¤!');
                return;
            }

            // Determine risk level based on market and stock type
            let risk = 'middle';
            if (MARKET_DATA.regime.state === 'RISK_ON' && sector.signal === 'SURGE') {
                risk = stockType === 'leader' ? 'conservative' : 'middle';
            }

            // Redirect to trade plan simulation with pre-filled data
            const params = new URLSearchParams({
                market: selectedStock.ticker.length <= 6 ? 'KR' : 'US',
                sector: selectedSector,
                ticker: selectedStock.ticker,
                name: selectedStock.name,
                price: selectedStock.price,
                risk: risk,
                period: 'ì¤‘ê¸°',
                capital: 50000000
            });

            window.location.href = `trade_plan_simulation.html?${params.toString()}`;
        }
    </script>
</body>
</html>
