# ğŸ” í•œêµ­íˆ¬ìì¦ê¶Œ API ì—°ê²° ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## ğŸš¨ í˜„ì¬ ìƒí™©
- âœ… ë¯¸êµ­ ì£¼ì‹ (Yahoo Finance): ì •ìƒ ì‘ë™
- âŒ í•œêµ­ ì£¼ì‹ (í•œêµ­íˆ¬ìì¦ê¶Œ API): ì—°ê²° ì‹¤íŒ¨

---

## ğŸ“‹ ë‹¨ê³„ë³„ ì§„ë‹¨ ë°©ë²•

### Step 1: API í‚¤ í™•ì¸
```bash
cd backend
cat .env
```

**í™•ì¸ ì‚¬í•­:**
- `KIS_APP_KEY` ê°’ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- `KIS_APP_SECRET` ê°’ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- ê°’ì— ê³µë°±ì´ë‚˜ ë”°ì˜´í‘œê°€ ì—†ëŠ”ê°€?

**í˜„ì¬ .env íŒŒì¼:**
```
KIS_APP_KEY=PSVPqsYslqRmx7N9ljFmRqhZaxuvGvirVPir
KIS_APP_SECRET=614neRBEBcVch8Gbw1NZicylNBxF0qDfJCw1LtTdqGbQ1cusv08QhyHO02ZSjj94iIETT6J1wFTGHIs4QbCVGkGWvluSqDaaPLOSjokXx7XdnorXRZMieEUOB4UO3D2bv5mcwYbNFU2dM28FV1NQsoYWK5kYNts4zzh+6kycuLmUdEDbqWg=
```

âœ… **í˜•ì‹ì€ ì˜¬ë°”ë¦„**

---

### Step 2: API ì—°ê²° í…ŒìŠ¤íŠ¸

```bash
cd backend
python test_kis_api.py
```

**ì˜ˆìƒ ì¶œë ¥ (ì„±ê³µ ì‹œ):**
```
============================================================
í•œêµ­íˆ¬ìì¦ê¶Œ API ì—°ê²° í…ŒìŠ¤íŠ¸
============================================================

1. API ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì¤‘...
   âœ… ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ

2. API í‚¤ í™•ì¸...
   KIS_APP_KEY: PSVPqsYslq... (ì´ 38ì)
   KIS_APP_SECRET: 614neRBEBc... (ì´ 174ì)

3. Access Token ë°œê¸‰ ì¤‘...
   âœ… í† í° ë°œê¸‰ ì„±ê³µ: eyJ0eXAiOiJKV1QiLCJ...

4. ì‚¼ì„±ì „ì (005930) í˜„ì¬ê°€ ì¡°íšŒ ì¤‘...
   âœ… ì¡°íšŒ ì„±ê³µ!
   ì¢…ëª©ëª…: ì‚¼ì„±ì „ì
   í˜„ì¬ê°€: 75,200ì›
   ë“±ë½ë¥ : +1.50%
   ê±°ë˜ëŸ‰: 12,345,678ì£¼

5. LIGë„¥ìŠ¤ì› (079550) í˜„ì¬ê°€ ì¡°íšŒ ì¤‘...
   âœ… ì¡°íšŒ ì„±ê³µ!
   ì¢…ëª©ëª…: LIGë„¥ìŠ¤ì›
   í˜„ì¬ê°€: 544,500ì›
   ë“±ë½ë¥ : +2.30%

============================================================
âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!
í•œêµ­íˆ¬ìì¦ê¶Œ API ì—°ê²°ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
============================================================
```

**ì˜ˆìƒ ì¶œë ¥ (ì‹¤íŒ¨ ì‹œ):**
ì‹¤ì œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ì•¼ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### Step 3: ì¼ë°˜ì ì¸ ì—ëŸ¬ ì›ì¸ ë° í•´ê²°

#### âŒ ì—ëŸ¬ 1: "Invalid API key"
**ì›ì¸:** API í‚¤ ë˜ëŠ” ì‹œí¬ë¦¿ì´ ì˜ëª»ë¨

**í•´ê²°:**
1. í•œêµ­íˆ¬ìì¦ê¶Œ API í¬í„¸ ì ‘ì†
2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ìƒì„¸ë³´ê¸°
3. API í‚¤ì™€ ì‹œí¬ë¦¿ ë³µì‚¬
4. `.env` íŒŒì¼ ì—…ë°ì´íŠ¸

---

#### âŒ ì—ëŸ¬ 2: "Unauthorized" (401)
**ì›ì¸:** 
- API í‚¤ê°€ ë§Œë£Œë¨
- ì•± ìƒíƒœê°€ ë¹„í™œì„±í™”ë¨

**í•´ê²°:**
1. API í¬í„¸ì—ì„œ ì•± ìƒíƒœ í™•ì¸
2. "ìš´ì˜" ìƒíƒœì¸ì§€ í™•ì¸
3. í•„ìš”ì‹œ ìƒˆ API í‚¤ ë°œê¸‰

---

#### âŒ ì—ëŸ¬ 3: "Forbidden" (403)
**ì›ì¸:** 
- IP ì œí•œ
- API ì‚¬ìš© ê¶Œí•œ ì—†ìŒ

**í•´ê²°:**
1. API í¬í„¸ â†’ ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ IP ê´€ë¦¬
2. í˜„ì¬ IP ì£¼ì†Œ ì¶”ê°€ ë˜ëŠ” "ì „ì²´ í—ˆìš©" ì„¤ì •
3. API ê¶Œí•œ í™•ì¸ (ì£¼ì‹ ì‹œì„¸ ì¡°íšŒ ê¶Œí•œ í•„ìš”)

---

#### âŒ ì—ëŸ¬ 4: "Rate limit exceeded"
**ì›ì¸:** API í˜¸ì¶œ íšŸìˆ˜ ì´ˆê³¼ (ë¶„ë‹¹ 20íšŒ ì œí•œ)

**í•´ê²°:**
- ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
- scheduler.pyì—ì„œ ì¢…ëª© ìˆ˜ ì¤„ì´ê¸° (í…ŒìŠ¤íŠ¸ìš©)

---

#### âŒ ì—ëŸ¬ 5: "Connection timeout"
**ì›ì¸:** 
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ
- ë°©í™”ë²½ ì°¨ë‹¨

**í•´ê²°:**
1. ì¸í„°ë„· ì—°ê²° í™•ì¸
2. ë°©í™”ë²½ì—ì„œ `openapi.koreainvestment.com` í—ˆìš©
3. í”„ë¡ì‹œ ì„¤ì • í™•ì¸

---

#### âŒ ì—ëŸ¬ 6: "Market closed"
**ì›ì¸:** ì¥ ë§ˆê° ì‹œê°„ (ì˜¤í›„ 3:30 ì´í›„)

**í•´ê²°:**
- ì •ìƒ ë™ì‘ (ì˜¤í›„ 6ì‹œ ìë™ ì—…ë°ì´íŠ¸ëŠ” ì „ì¼ ì¢…ê°€ ì‚¬ìš©)
- `get_current_price`ëŠ” ì¥ ì‹œê°„ì—ë§Œ ì •í™•í•œ ì‹œì„¸ ì œê³µ

---

### Step 4: API í‚¤ ì¬ë°œê¸‰ (í•„ìš” ì‹œ)

#### í•œêµ­íˆ¬ìì¦ê¶Œ API í¬í„¸
https://apiportal.koreainvestment.com/

#### ì ˆì°¨:
1. ë¡œê·¸ì¸
2. **ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜** ë©”ë‰´
3. ê¸°ì¡´ ì•± ì„ íƒ ë˜ëŠ” ìƒˆ ì•± ë“±ë¡
4. **API KEY ë°œê¸‰** í´ë¦­
5. ìƒˆ API Keyì™€ Secret ë³µì‚¬
6. `backend/.env` íŒŒì¼ ì—…ë°ì´íŠ¸:
   ```
   KIS_APP_KEY=ìƒˆ_í‚¤_ì—¬ê¸°
   KIS_APP_SECRET=ìƒˆ_ì‹œí¬ë¦¿_ì—¬ê¸°
   ```

---

### Step 5: ì‹¤ì „ ëª¨ë“œ vs ëª¨ì˜íˆ¬ì ëª¨ë“œ

í•œêµ­íˆ¬ìì¦ê¶Œ APIëŠ” ë‘ ê°€ì§€ ëª¨ë“œê°€ ìˆìŠµë‹ˆë‹¤:

#### ì‹¤ì „ ëª¨ë“œ
- URL: `https://openapi.koreainvestment.com:9443`
- ì‹¤ì œ ê³„ì¢Œ ì—°ë™
- **í˜„ì¬ ì‚¬ìš© ì¤‘** âœ…

#### ëª¨ì˜íˆ¬ì ëª¨ë“œ
- URL: `https://openapivts.koreainvestment.com:9443`
- ê°€ìƒ ê³„ì¢Œ
- í…ŒìŠ¤íŠ¸ìš©

**í™•ì¸ ë°©ë²•:**
```python
# backend/services/korea_investment_api.py
self.base_url = "https://openapi.koreainvestment.com:9443"  # ì‹¤ì „
# ë˜ëŠ”
self.base_url = "https://openapivts.koreainvestment.com:9443"  # ëª¨ì˜
```

---

## ğŸ”§ ë¹ ë¥¸ í•´ê²° ë°©ë²•

### ë°©ë²• 1: í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
cd backend
python test_kis_api.py
```

â†’ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  ìœ„ì˜ Step 3ì—ì„œ í•´ë‹¹ ì—ëŸ¬ ì°¾ê¸°

---

### ë°©ë²• 2: ìˆ˜ë™ìœ¼ë¡œ API í‚¤ ì¬ì…ë ¥

ìƒˆ API í‚¤ë¥¼ ë°›ìœ¼ì…¨ë‹¤ë©´:

1. `backend/.env` íŒŒì¼ ì—´ê¸°
2. ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ìˆ˜ì •:
   ```
   KIS_APP_KEY=ìƒˆë¡œë°›ì€í‚¤
   KIS_APP_SECRET=ìƒˆë¡œë°›ì€ì‹œí¬ë¦¿
   ```
3. ì„œë²„ ì¬ì‹œì‘
4. í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰

---

### ë°©ë²• 3: ì„ì‹œë¡œ í•œêµ­ ì£¼ì‹ ì œì™¸

í•œêµ­íˆ¬ìì¦ê¶Œ API ë¬¸ì œê°€ ê³„ì†ë˜ë©´:

```python
# backend/scheduler.py

STOCK_LIST = {
    "US": [
        {"ticker": "LMT", "name": "Lockheed Martin"},
        {"ticker": "JNJ", "name": "Johnson & Johnson"}
    ],
    "KR": [
        # ì„ì‹œë¡œ ì£¼ì„ ì²˜ë¦¬
        # {"ticker": "012450", "name": "í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤"},
        # {"ticker": "079550", "name": "LIGë„¥ìŠ¤ì›"},
    ]
}
```

â†’ ë¯¸êµ­ ì£¼ì‹ë§Œìœ¼ë¡œ ìš°ì„  ìš´ì˜ ê°€ëŠ¥

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| API í‚¤ ì„¤ì • | âœ… ì™„ë£Œ | .env íŒŒì¼ í™•ì¸ |
| ë¯¸êµ­ ì£¼ì‹ (Yahoo) | âœ… ì‘ë™ | LMT, JNJ ì¡°íšŒ ê°€ëŠ¥ |
| í•œêµ­ ì£¼ì‹ (KIS API) | âŒ ì‹¤íŒ¨ | ì›ì¸ ì§„ë‹¨ í•„ìš” |
| ìŠ¤ì¼€ì¤„ëŸ¬ | âœ… êµ¬í˜„ | ì½”ë“œ ì™„ì„± |
| í”„ë¡ íŠ¸ì—”ë“œ | âœ… êµ¬í˜„ | JSON ë¡œë” ì™„ì„± |

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰:**
   ```bash
   cd backend
   python test_kis_api.py
   ```

2. **ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸:**
   - êµ¬ì²´ì ì¸ ì—ëŸ¬ ë‚´ìš©ì„ ì•Œë ¤ì£¼ì‹œë©´ ì •í™•í•œ í•´ê²°ì±… ì œì‹œ ê°€ëŠ¥

3. **API í‚¤ ì¬ë°œê¸‰:**
   - í•„ìš”í•˜ë‹¤ë©´ ìƒˆ API í‚¤ë¥¼ ë°œê¸‰ë°›ì•„ ì œê³µ ê°€ëŠ¥

---

## ğŸ’¬ ì—ëŸ¬ ë©”ì‹œì§€ ë³´ê³  ì–‘ì‹

ì•„ë˜ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ì •í™•í•œ í•´ê²°ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤:

```
1. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê²°ê³¼:
   $ python test_kis_api.py
   [ì—¬ê¸°ì— ì¶œë ¥ ë‚´ìš© ë¶™ì—¬ë„£ê¸°]

2. ì—ëŸ¬ ë©”ì‹œì§€:
   [êµ¬ì²´ì ì¸ ì—ëŸ¬ ë‚´ìš©]

3. API í¬í„¸ ìƒíƒœ:
   - ì•± ìƒíƒœ: [ìš´ì˜/ê°œë°œ/ì¤‘ì§€]
   - IP ì„¤ì •: [íŠ¹ì • IP/ì „ì²´ í—ˆìš©]
   - API ê¶Œí•œ: [ì–´ë–¤ ê¶Œí•œì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€]

4. ê¸°íƒ€:
   - ìƒˆ API í‚¤ê°€ í•„ìš”í•œê°€ìš”? (Y/N)
   - ëª¨ì˜íˆ¬ì ëª¨ë“œë¡œ ë³€ê²½í• ê¹Œìš”? (Y/N)
```

---

> **ì‘ì„±ì¼:** 2026-01-21  
> **ìƒíƒœ:** ì§„ë‹¨ ëŒ€ê¸° ì¤‘  
> **ë‹¤ìŒ:** test_kis_api.py ì‹¤í–‰ ê²°ê³¼ í™•ì¸
